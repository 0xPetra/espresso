<!--
 Copyright (c) 2022 Espresso Systems (espressosys.com)
 This file is part of the Espresso library.

 This program is free software: you can redistribute it and/or modify it under the terms of the GNU
 General Public License as published by the Free Software Foundation, either version 3 of the
 License, or (at your option) any later version.
 This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 General Public License for more details.
 You should have received a copy of the GNU General Public License along with this program. If not,
 see <https://www.gnu.org/licenses/>.
-->

<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <style>
      body {
          font-family: Arial, Helvetica, sans-serif;
          padding: 16px;
      }
      input[type=button], input[type=submit], input[type=reset] {
          padding: 4px;
          margin: 4px;
          cursor: pointer;
      }
      label {
          margin-top:16px;
          display:inline-block
      }
    </style>
    <script type="text/javascript">
      function redirectClean(){
          console.log('oh, hey');
          var value_1 = document.getElementById("raddr").value;
          var value_2 = document.getElementById("amt").value;
          window.location = '/transfer/'+value_1+'/'+value_2;
          return false;
      }

      // Websocket
      function uilog(msg) {
          console.log(msg);
          var ta = document.getElementById('events');
          if (ta.value.length) { ta.value += '\n'; }
          ta.value += msg;
          ta.scrollTop = ta.scrollHeight;
      }

      var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
      var host = '127.0.0.1:8080';
      var address = protocol + host;
      var socket = new WebSocket(address);
      console.log('looking for server at ' + address);
      console.log('host: ' + window.location.host);

      function initialize() {
          (function() {
              socket.onmessage = function(msg) {
                  uilog(msg.data);
              };
              uilog('Web Socket enabled.');
          })();
      }
      function onSend(){
          uilog('Web Socket Send button pressed');
	  socket.send('Web Socket Send button pressed');
      }

      window.addEventListener("load", initialize);
    </script>
  </head>
  <body> 
    <h1>Transfer</h1>
    <p>Payer Account: LA~fe9350s â§‰</p>
    <p>Account Balance: 100 jellybeans</p>
    <div style="width:50%;min-width:300px">
      <div style="background-color:#f4f4f4;margin:16px;padding:16px;border:1px solid black;box-shadow:4px 4px lightgray">
        <form action="/transfer/" method="get">
          <fieldset style="background-color:#f6f6f6">
            <legend >Anonymous Jellybean Transfer</legend>
            <div align="right">
              <label for="raddr">Recipient's address:</label>
              <input type="text" id="raddr" name="raddr" value="LA~whatever"><br>
            </div>
            <br>
            <div align="right">
              <label for="amt">Amount:</label>
              <input type="text" id="amt" name="amt" value="2"><br><br>
            </div>
            <div align="right" style="float:right">
              <input type="button"
                     name="submit"
                     onclick="redirectClean()"
                     value="Send">
              <input type="button"
                     name="submit"
                     onclick="onSend()"
                     value="Web Socket Send">
            </div><br>
          </fieldset>
        </form>
      </div>
    <h2>Status</h2>
    <textarea id="events" name="events" rows="10" style="width:100%;min-width:300px;margin:16px;padding:4px"></textarea>
    </div>
    <h1>TODO</h1>
    <ul>
      <li>Hard code addresses</li>
      <li>Hard code initial balances</li>
      <li>Event stream from the ledger</li>
    </ul>
  </body>
</html>
